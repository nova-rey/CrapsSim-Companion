<script type="text/html" data-template-name="bet-type" data-label="Bet: Line/Place/Lay/Odds">
  <div class="form-row">
    <label for="node-input-kind"><i class="fa fa-dice"></i> Bet type</label>
    <select id="node-input-kind">
      <option value="Pass">Pass Line</option>
      <option value="DontPass">Don't Pass Line</option>
      <option value="Come">Come</option>
      <option value="DontCome">Don't Come</option>
      <option value="PassOdds">Pass Odds</option>
      <option value="DontPassOdds">Don't Pass Odds</option>
      <option value="ComeOdds">Come Odds</option>
      <option value="DontComeOdds">Don't Come Odds</option>
      <option value="Field">Field</option>
      <option value="Place">Place</option>
      <option value="Lay">Lay</option>
    </select>
  </div>

  <div class="form-row">
    <label for="node-input-valueSource"><i class="fa fa-sliders"></i> Amount source</label>
    <select id="node-input-valueSource">
      <option value="fixed">Fixed (enter amount)</option>
      <option value="feed">Feed (from Bet Variable / vars)</option>
    </select>
  </div>

  <div class="form-row node-fixed-only">
    <label for="node-input-amount"><i class="fa fa-dollar"></i> Amount</label>
    <input type="number" id="node-input-amount" min="0" value="0">
  </div>

  <div class="form-row node-fixed-only">
    <label for="node-input-unitType"><i class="fa fa-balance-scale"></i> Units</label>
    <select id="node-input-unitType">
      <option value="dollars">dollars</option>
      <option value="units">units</option>
    </select>
  </div>

  <div class="form-row" id="node-input-number-row">
    <label for="node-input-number"><i class="fa fa-hashtag"></i> Number</label>
    <select id="node-input-number">
      <option value=""></option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>
  </div>

  <div class="form-row" id="node-input-working-row">
    <label for="node-input-working"><i class="fa fa-bell"></i> Working on come-out</label>
    <input type="checkbox" id="node-input-working">
  </div>

  <div class="form-row">
    <label for="node-input-betId"><i class="fa fa-tag"></i> Bet ID</label>
    <input type="text" id="node-input-betId" placeholder="e.g. place6 (optional)">
  </div>

  <div class="form-row">
    <label for="node-input-note"><i class="fa fa-sticky-note"></i> Note</label>
    <input type="text" id="node-input-note" placeholder="optional comment for this bet">
  </div>
</script>

<script type="text/html" data-help-name="bet-type">
  <h3>What this node does</h3>
  <p>Creates line, place, lay, field, and odds bet entries that feed into <b>Compile Strategy</b>. Options map directly to the CrapsSim bet surface.</p>

  <h3>Inputs</h3>
  <ul>
    <li><b>Bet type</b>: Choose Pass/Don't Pass, Come/Don't Come, Field, Place, Lay, or the matching odds bet. Place/Lay and Come Odds require a point number.</li>
    <li><b>Amount source</b>: <b>Fixed</b> uses the Amount and Units fields. <b>Feed</b> pulls amount+unit from <code>msg.var</code>, <code>msg.vars[betId]</code>, or <code>msg.amount/msg.unitType</code> when provided.</li>
    <li><b>Working on come-out</b>: Applies to odds bets when they should work on the come-out roll.</li>
    <li><b>Bet ID</b>/<b>Note</b>: Optional metadata stored with the bet entry.</li>
  </ul>

  <h3>Outputs</h3>
  <p>Appends a bet step to <code>msg.recipe.steps</code> with the selected bet type, amount, unitType, optional number, betId, note, and working flag. Passes the message through for downstream bet nodes or Compile Strategy.</p>

  <h3>Errors</h3>
  <ul>
    <li>Missing number for Place/Lay/Come Odds/Don't Come Odds.</li>
    <li>Using <b>Feed</b> without supplying amount/unitType via message variables.</li>
    <li>Odds are only accepted by the Engine API runner; the vanilla exporter will reject them.</li>
  </ul>
</script>

  <script type="text/javascript">
    (function(){
      function toggleFixedFields() {
        const v = $("#node-input-valueSource").val();
        const show = (v === "fixed");
        $(".node-fixed-only")[show ? "show" : "hide"]();

        const kind = $("#node-input-kind").val();
        const needsNumber = ["Place", "Lay", "ComeOdds", "DontComeOdds"].includes(kind);
        const isOdds = ["PassOdds", "DontPassOdds", "ComeOdds", "DontComeOdds"].includes(kind);

        $("#node-input-number-row")[needsNumber ? "show" : "hide"]();
        $("#node-input-working-row")[isOdds ? "show" : "hide"]();
      }
      function labelWorkingSuffix(ctx) {
        return ctx.working ? " (work)" : "";
      }
      RED.nodes.registerType("bet-type", {
        category: "Craps: Strategy Builder",
        color: "#4C8BF5",
        icon: "icons/builder-node.svg",
        defaults: {
          kind:        { value: "Pass", required: true },
          number:      { value: "" },
          betId:       { value: "" },
          valueSource: { value: "fixed", required: true },
          amount:      { value: 0 },
          unitType:    { value: "units" },
          note:        { value: "" },
          working:     { value: false }
        },
        inputs: 1,
        outputs: 1,
        oneditprepare: function(){
          $("#node-input-valueSource").on("change", toggleFixedFields);
          $("#node-input-kind").on("change", toggleFixedFields);
          toggleFixedFields();
        },
        paletteLabel: "Bet: Line/Place/Lay/Odds",
        label: function() {
          const n  = this.number ? ` ${this.number}` : "";
          const vs = this.valueSource === "fixed" ? ` ${this.amount} ${this.unitType}` : " (feed)";
          return `${this.kind}${n}${vs}${labelWorkingSuffix(this)}`;
        }
      });
    })();
  </script>
