<script type="text/html" data-template-name="bet-prop" data-label="Bet: Props/Hardways/Hops">
  <div class="form-row">
    <label for="node-input-propKind"><i class="fa fa-diamond"></i> Prop kind</label>
    <select id="node-input-propKind">
      <option value="Hardway">Hardway</option>
    </select>
  </div>

  <div class="form-row">
    <label for="node-input-valueSource"><i class="fa fa-sliders"></i> Amount source</label>
    <select id="node-input-valueSource">
      <option value="fixed">Fixed (enter amount)</option>
      <option value="feed">Feed (from Bet Variable / vars)</option>
    </select>
  </div>

  <div class="form-row node-fixed-only">
    <label for="node-input-amount"><i class="fa fa-dollar"></i> Amount</label>
    <input type="number" id="node-input-amount" min="0" value="0">
  </div>

  <div class="form-row node-fixed-only">
    <label for="node-input-unitType"><i class="fa fa-balance-scale"></i> Units</label>
    <select id="node-input-unitType">
      <option value="dollars">dollars</option>
      <option value="units">units</option>
    </select>
  </div>

  <div class="form-row hardway-only">
    <label for="node-input-number"><i class="fa fa-hashtag"></i> Number</label>
    <select id="node-input-number">
      <option value=""></option>
      <option value="4">4</option>
      <option value="6">6</option>
      <option value="8">8</option>
      <option value="10">10</option>
    </select>
  </div>

  <div class="form-row">
    <label for="node-input-betId"><i class="fa fa-tag"></i> Bet ID</label>
    <input type="text" id="node-input-betId" placeholder="e.g. hard8 (optional)">
  </div>

  <div class="form-row">
    <label for="node-input-note"><i class="fa fa-sticky-note"></i> Note</label>
    <input type="text" id="node-input-note" placeholder="optional comment for this prop bet">
  </div>
</script>

<script type="text/html" data-help-name="bet-prop">
  <h3>What this node does</h3>
  <p>Creates CrapsSim-aligned prop entries for the supported Hardway bets so they flow into <b>Compile Strategy</b> and the Engine/vanilla exporters.</p>

  <h3>Inputs</h3>
  <ul>
    <li><b>Prop kind</b>: Hardway wagers on 4, 6, 8, or 10. The point selector appears only for Hardways.</li>
    <li><b>Amount source</b>: <b>Fixed</b> uses the Amount and Units fields. <b>Feed</b> pulls <code>amount</code> + <code>unitType</code> from <code>msg.var.value</code>, <code>msg.vars[betId]</code>, or <code>msg.amount</code>/<code>msg.unitType</code>.</li>
    <li><b>Bet ID</b>/<b>Note</b>: Optional metadata applied to the generated bet step.</li>
  </ul>

  <h3>Outputs</h3>
  <p>Appends a Hardway bet step to <code>msg.recipe.steps</code> with the kind, amount, unitType, number, and optional betId/note. The message continues downstream to <b>Compile Strategy</b>.</p>

  <h3>Errors</h3>
  <ul>
    <li>Omitting a number for Hardway bets.</li>
    <li>Using <b>Feed</b> without providing amount/unitType via message variables.</li>
    <li>Selecting a prop kind that is not supported by the current CrapsSim bet surface (only Hardways are mapped).</li>
  </ul>
</script>

<script type="text/javascript">
  (function(){
    function toggleHardway() {
      const k = $("#node-input-propKind").val();
      const show = (k === "Hardway");
      $(".hardway-only")[show ? "show" : "hide"]();
    }
    function toggleFixedFields() {
      const v = $("#node-input-valueSource").val();
      const show = (v === "fixed");
      $(".node-fixed-only")[show ? "show" : "hide"]();
    }
    RED.nodes.registerType("bet-prop", {
      category: "craps-bets",
      color: "#4C8BF5",
      icon: "icons/builder-node.svg",
      defaults: {
        propKind:    { value: "Hardway", required: true },
        number:      { value: "" },
        betId:       { value: "" },
        valueSource: { value: "fixed", required: true },
        amount:      { value: 0 },
        unitType:    { value: "units" },
        note:        { value: "" }
      },
      inputs: 1,
      outputs: 1,
      oneditprepare: function(){
        $("#node-input-propKind").on("change", toggleHardway);
        $("#node-input-valueSource").on("change", toggleFixedFields);
        toggleHardway();
        toggleFixedFields();
      },
      paletteLabel: "Bet: Props/Hardways/Hops",
      label: function() {
        return "Bet: Props/Hardways/Hops";
      }
    });
  })();
</script>
