<script type="text/html" data-template-name="craps-batch-runner" data-label="Run: Batch Simulation">
  <div class="form-row">
    <label for="node-input-apiConfig"><i class="fa fa-cog"></i> API Config</label>
    <input type="text" id="node-input-apiConfig" placeholder="Select api config">
  </div>
  <div class="form-row">
    <label for="node-input-rolls"><i class="fa fa-repeat"></i> Rolls per run</label>
    <input type="number" id="node-input-rolls" placeholder="100">
  </div>
  <div class="form-row">
    <label for="node-input-seed_start"><i class="fa fa-sort-numeric-asc"></i> Seed start</label>
    <input type="number" id="node-input-seed_start" placeholder="1000">
  </div>
  <div class="form-row">
    <label for="node-input-seed_count"><i class="fa fa-calculator"></i> Seed count</label>
    <input type="number" id="node-input-seed_count" placeholder="10">
  </div>
  <div class="form-row">
    <label for="node-input-strict_mode"><i class="fa fa-exclamation-triangle"></i> Strict Mode</label>
    <input type="checkbox" id="node-input-strict_mode">
  </div>
  <div class="form-row">
    <label for="node-input-label"><i class="fa fa-tag"></i> Label</label>
    <input type="text" id="node-input-label" placeholder="optional label">
  </div>
</script>

<script type="text/html" data-help-name="craps-batch-runner">
  <h3>What this node does</h3>
  <p>Executes the compiled strategy across multiple seeded runs using the CrapsSim Engine API.</p>

  <h3>Inputs</h3>
  <ul>
    <li><b>API Config</b>: Engine endpoint and auth via config node.</li>
    <li><b>Rolls per run</b>: Default rolls per simulation (override with <code>msg.rolls</code>).</li>
    <li><b>Seeds</b>: Provide <code>msg.seeds</code> (array) or <code>msg.seed_start</code> plus <code>msg.seed_count</code> to auto-generate a contiguous range. Node fields seed_start/seed_count serve as defaults.</li>
    <li><b>Strict Mode</b>: Enables stricter validation.</li>
    <li><b>Message fields</b>: requires <code>msg.strategy_config</code>; optional parity/script inputs via <code>msg.roll_mode</code>, <code>msg.parity_mode</code>, and <code>msg.dice_script</code>.</li>
  </ul>

  <h3>Outputs</h3>
  <p>Populates <code>msg.batch_result</code> (per-seed results), <code>msg.batch_summary</code> (aggregated totals), and sets <code>msg.payload</code> to the summary. Also surfaces <code>msg.batch_error</code> if a run fails.</p>

  <h3>Errors</h3>
  <ul>
    <li>Missing <code>msg.strategy_config</code> or seed configuration.</li>
    <li>HTTP errors during any run, stopping the batch on the first failure.</li>
    <li>Invalid dice script when parity/script mode is active.</li>
  </ul>
</script>

  <script type="text/javascript">
    RED.nodes.registerType("craps-batch-runner", {
    category: "craps-output",
    color: "#6A4CCF",
    icon: "icons/execution-node.svg",
    inputs: 1,
    outputs: 1,
    defaults: {
      apiConfig: { value: "", type: "craps-api-config", required: true },
      rolls: { value: 100 },
      seed_start: { value: "" },
      seed_count: { value: "" },
      strict_mode: { value: false },
      label: { value: "" }
    },
    paletteLabel: "Run: Batch Simulation",
    label: function() {
      return "Run: Batch Simulation";
    }
    });
  </script>
